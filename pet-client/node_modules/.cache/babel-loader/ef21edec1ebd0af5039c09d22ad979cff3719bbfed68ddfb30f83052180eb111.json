{"ast":null,"code":"import _objectSpread from \"E:/vue3/pet-home-master/pet-client/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";\nimport \"core-js/modules/es.array.filter.js\";\nimport \"core-js/modules/es.object.to-string.js\";\nimport \"core-js/modules/es.array.sort.js\";\nimport \"core-js/modules/es.function.name.js\";\nimport \"core-js/modules/web.timers.js\";\nimport { reactive, toRefs, watch } from 'vue';\nimport PetCardVue from '@/components/PetCard.vue';\nimport { userStore } from '@/store/user.js';\nimport { Dialog, Toast } from 'vant';\nimport SkeletonVue from '@/views/home/components/Skeleton.vue';\nexport default {\n  setup: function setup(props) {\n    var uStore = userStore();\n    var state = reactive({\n      loading: false,\n      // 下来刷新的状态\n      optionType: [{\n        text: '全部',\n        value: 'all'\n      }, {\n        text: '类别：犬',\n        value: '犬'\n      }, {\n        text: '类别：猫',\n        value: '猫'\n      }, {\n        text: '类别：鸟',\n        value: '鸟'\n      }, {\n        text: '类别：兔',\n        value: '兔'\n      }, {\n        text: '类别：鼠',\n        value: '鼠'\n      }, {\n        text: '类别：鱼',\n        value: '鱼'\n      }],\n      optionSort: [{\n        text: '时间排序',\n        value: 'time'\n      }, {\n        text: '喜爱排序',\n        value: 'fond'\n      }],\n      type: 'all',\n      sort: 'time',\n      petFondList: [],\n      show: false,\n      actions: [{\n        name: '取消喜爱'\n      }],\n      actionPetId: '',\n      refreshPage: true // 当前页面是否刷新\n    });\n\n    var list = [];\n    var setPetFondList = function setPetFondList(list) {\n      state.petFondList = state.type === 'all' ? list : list.filter(function (value) {\n        return value.petcategory === state.type;\n      });\n    };\n    var initFondList = function initFondList() {\n      uStore.getFondInfoSync().then(function (res) {\n        list = uStore.getFondInfo();\n        setPetFondList(list);\n      });\n    };\n    initFondList();\n    watch([function () {\n      return state.type;\n    }, function () {\n      return state.sort;\n    }], function (newVal, oldVal) {\n      list = uStore.getFondInfo();\n      if (newVal[1] === 'time') {\n        list = list.sort(function (a, b) {\n          return b.ctime - a.ctime;\n        });\n      }\n      setPetFondList(list);\n    }, {\n      deep: true,\n      immediate: true\n    });\n    var sheetOpen = function sheetOpen(e) {\n      state.show = e.type;\n      state.actionPetId = e.petid;\n    };\n    var onClose = function onClose() {\n      state.show = false;\n    };\n    var onSelect = function onSelect(e) {\n      if (e.name === '取消喜爱') {\n        Dialog.confirm({\n          message: '确定将宠物移除吗？'\n        }).then(function () {\n          // console.log(state.actionPetId);\n          uStore.setUserCollect(state.actionPetId);\n          var type = state.type;\n          state.type = '0';\n          state.type = type;\n          state.show = false;\n        })[\"catch\"](function () {\n          state.show = false;\n        });\n      }\n    };\n    var onRefresh = function onRefresh() {\n      // 下拉刷新\n      initFondList();\n      state.refreshPage = false;\n      setTimeout(function () {\n        var type = state.type;\n        state.type = '0';\n        state.type = type;\n        state.refreshPage = true;\n        Toast('刷新成功');\n        state.loading = false;\n      }, 1000);\n    };\n    return _objectSpread(_objectSpread({}, toRefs(state)), {}, {\n      onClose: onClose,\n      onSelect: onSelect,\n      sheetOpen: sheetOpen,\n      onRefresh: onRefresh\n    });\n  },\n  components: {\n    PetCardVue: PetCardVue,\n    SkeletonVue: SkeletonVue\n  }\n};","map":{"version":3,"names":["reactive","toRefs","watch","PetCardVue","userStore","Dialog","Toast","SkeletonVue","setup","props","uStore","state","loading","optionType","text","value","optionSort","type","sort","petFondList","show","actions","name","actionPetId","refreshPage","list","setPetFondList","filter","petcategory","initFondList","getFondInfoSync","then","res","getFondInfo","newVal","oldVal","a","b","ctime","deep","immediate","sheetOpen","e","petid","onClose","onSelect","confirm","message","setUserCollect","onRefresh","setTimeout","_objectSpread","components"],"sources":["E:\\vue3\\pet-home-master\\pet-client\\src\\views\\fond\\index.vue"],"sourcesContent":["<template>\n  <div class=\"page\">\n    <van-pull-refresh v-model=\"loading\" @refresh=\"onRefresh\">\n      <div class=\"header\">\n        <p class=\"title\">喜爱</p>\n        <van-icon name=\"search\" />\n      </div>\n\n      <div class=\"content_wrap\">\n        <van-sticky>\n          <div class=\"tool_wrap\">\n            <van-dropdown-menu active-color=\"#f8b158\">\n              <van-dropdown-item v-model=\"type\" :options=\"optionType\" />\n              <van-dropdown-item v-model=\"sort\" :options=\"optionSort\" />\n            </van-dropdown-menu>\n          </div>\n        </van-sticky>\n\n        <div class=\"content\" v-if=\"petFondList.length !== 0 && refreshPage\">\n          <div class=\"item\" v-for=\"item in petFondList\" :key=\"item.petid\">\n            <PetCardVue :petItem=\"item\" :petCollect=\"false\" @open=\"sheetOpen\" />\n          </div>\n        </div>\n\n        <div class=\"content_sheleton\" v-else-if=\"!refreshPage\">\n          <SkeletonVue />\n        </div>\n\n        <van-empty class=\"custom-image\" :image=\"require('@/assets/imgs/page/empty.png')\" description=\"没有什么也没有汪\" v-else-if=\"petFondList.length == 0\" />\n      </div>\n    </van-pull-refresh>\n\n    <van-action-sheet :show=\"show\" :actions=\"actions\" @cancel=\"onClose\" @select=\"onSelect\" cancel-text=\"取消\" />\n  </div>\n</template>\n\n<script>\nimport { reactive, toRefs, watch } from 'vue'\nimport PetCardVue from '@/components/PetCard.vue'\nimport { userStore } from '@/store/user.js'\nimport { Dialog, Toast } from 'vant'\nimport SkeletonVue from '@/views/home/components/Skeleton.vue'\n\nexport default {\n  setup(props) {\n    const uStore = userStore()\n    const state = reactive({\n      loading: false, // 下来刷新的状态\n      optionType: [\n        { text: '全部', value: 'all' },\n        { text: '类别：犬', value: '犬' },\n        { text: '类别：猫', value: '猫' },\n        { text: '类别：鸟', value: '鸟' },\n        { text: '类别：兔', value: '兔' },\n        { text: '类别：鼠', value: '鼠' },\n        { text: '类别：鱼', value: '鱼' }\n      ],\n      optionSort: [\n        { text: '时间排序', value: 'time' },\n        { text: '喜爱排序', value: 'fond' }\n      ],\n      type: 'all',\n      sort: 'time',\n      petFondList: [],\n      show: false,\n      actions: [\n        {\n          name: '取消喜爱'\n        }\n      ],\n      actionPetId: '',\n      refreshPage: true // 当前页面是否刷新\n    })\n\n    let list = []\n\n    const setPetFondList = list => {\n      state.petFondList =\n        state.type === 'all'\n          ? list\n          : list.filter(value => {\n              return value.petcategory === state.type\n            })\n    }\n\n    const initFondList = () => {\n      uStore.getFondInfoSync().then(res => {\n        list = uStore.getFondInfo()\n        setPetFondList(list)\n      })\n    }\n\n    initFondList()\n\n    watch(\n      [() => state.type, () => state.sort],\n      (newVal, oldVal) => {\n        list = uStore.getFondInfo()\n        if (newVal[1] === 'time') {\n          list = list.sort((a, b) => {\n            return b.ctime - a.ctime\n          })\n        }\n        setPetFondList(list)\n      },\n      { deep: true, immediate: true }\n    )\n\n    const sheetOpen = e => {\n      state.show = e.type\n      state.actionPetId = e.petid\n    }\n\n    const onClose = () => {\n      state.show = false\n    }\n\n    const onSelect = e => {\n      if (e.name === '取消喜爱') {\n        Dialog.confirm({\n          message: '确定将宠物移除吗？'\n        })\n          .then(() => {\n            // console.log(state.actionPetId);\n            uStore.setUserCollect(state.actionPetId)\n            const type = state.type\n            state.type = '0'\n            state.type = type\n            state.show = false\n          })\n          .catch(() => {\n            state.show = false\n          })\n      }\n    }\n\n    const onRefresh = () => {\n      // 下拉刷新\n      initFondList()\n      state.refreshPage = false\n      setTimeout(() => {\n        const type = state.type\n        state.type = '0'\n        state.type = type\n        state.refreshPage = true\n        Toast('刷新成功')\n        state.loading = false\n      }, 1000)\n    }\n\n    return {\n      ...toRefs(state),\n      onClose,\n      onSelect,\n      sheetOpen,\n      onRefresh\n    }\n  },\n  components: {\n    PetCardVue,\n    SkeletonVue\n  }\n}\n</script>\n\n<style lang=\"less\" scoped>\n.page {\n  width: 100%;\n  height: calc(100% - 50px);\n  background-color: @primary;\n  .header {\n    width: 100%;\n    height: 60px;\n    display: flex;\n    padding: 20px;\n    box-sizing: border-box;\n    justify-content: space-between;\n    align-items: center;\n    font-size: 0.5rem;\n    color: @color-text-header;\n  }\n  .content_wrap {\n    width: 100%;\n    min-height: calc(100vh - 110px);\n    background-color: #fff;\n    border-radius: 32px 32px 0 0;\n    overflow: hidden;\n    border-top: 4px solid #683931;\n    .tool_wrap {\n      margin-bottom: 15px;\n      :deep(.van-dropdown-menu__title) {\n        color: @card-color;\n      }\n    }\n    .content {\n      width: 100%;\n      overflow: scroll;\n      display: grid;\n      grid-template-columns: 50% 50%;\n      justify-items: center;\n      margin-bottom: 60px;\n      .item {\n        width: 91%;\n        margin-bottom: 20px;\n      }\n    }\n    .content_sheleton {\n      width: 100%;\n      height: calc(100vh - 158px);\n    }\n  }\n}\n:deep(.van-empty__image) {\n  opacity: 0.3;\n}\n:deep(.van-pull-refresh__head) {\n  color: #fff;\n}\n:deep(.van-loading) {\n  & > span {\n    color: #fff;\n  }\n}\n</style>\n"],"mappings":";;;;;;AAqCA,SAASA,QAAQ,EAAEC,MAAM,EAAEC,KAAI,QAAS,KAAI;AAC5C,OAAOC,UAAS,MAAO,0BAAyB;AAChD,SAASC,SAAQ,QAAS,iBAAgB;AAC1C,SAASC,MAAM,EAAEC,KAAI,QAAS,MAAK;AACnC,OAAOC,WAAU,MAAO,sCAAqC;AAE7D,eAAe;EACbC,KAAK,WAAAA,MAACC,KAAK,EAAE;IACX,IAAMC,MAAK,GAAIN,SAAS,EAAC;IACzB,IAAMO,KAAI,GAAIX,QAAQ,CAAC;MACrBY,OAAO,EAAE,KAAK;MAAE;MAChBC,UAAU,EAAE,CACV;QAAEC,IAAI,EAAE,IAAI;QAAEC,KAAK,EAAE;MAAM,CAAC,EAC5B;QAAED,IAAI,EAAE,MAAM;QAAEC,KAAK,EAAE;MAAI,CAAC,EAC5B;QAAED,IAAI,EAAE,MAAM;QAAEC,KAAK,EAAE;MAAI,CAAC,EAC5B;QAAED,IAAI,EAAE,MAAM;QAAEC,KAAK,EAAE;MAAI,CAAC,EAC5B;QAAED,IAAI,EAAE,MAAM;QAAEC,KAAK,EAAE;MAAI,CAAC,EAC5B;QAAED,IAAI,EAAE,MAAM;QAAEC,KAAK,EAAE;MAAI,CAAC,EAC5B;QAAED,IAAI,EAAE,MAAM;QAAEC,KAAK,EAAE;MAAI,EAC5B;MACDC,UAAU,EAAE,CACV;QAAEF,IAAI,EAAE,MAAM;QAAEC,KAAK,EAAE;MAAO,CAAC,EAC/B;QAAED,IAAI,EAAE,MAAM;QAAEC,KAAK,EAAE;MAAO,EAC/B;MACDE,IAAI,EAAE,KAAK;MACXC,IAAI,EAAE,MAAM;MACZC,WAAW,EAAE,EAAE;MACfC,IAAI,EAAE,KAAK;MACXC,OAAO,EAAE,CACP;QACEC,IAAI,EAAE;MACR,EACD;MACDC,WAAW,EAAE,EAAE;MACfC,WAAW,EAAE,IAAG,CAAE;IACpB,CAAC;;IAED,IAAIC,IAAG,GAAI,EAAC;IAEZ,IAAMC,cAAa,GAAI,SAAjBA,cAAaA,CAAID,IAAG,EAAK;MAC7Bd,KAAK,CAACQ,WAAU,GACdR,KAAK,CAACM,IAAG,KAAM,KAAI,GACfQ,IAAG,GACHA,IAAI,CAACE,MAAM,CAAC,UAAAZ,KAAI,EAAK;QACnB,OAAOA,KAAK,CAACa,WAAU,KAAMjB,KAAK,CAACM,IAAG;MACxC,CAAC;IACT;IAEA,IAAMY,YAAW,GAAI,SAAfA,YAAWA,CAAA,EAAU;MACzBnB,MAAM,CAACoB,eAAe,EAAE,CAACC,IAAI,CAAC,UAAAC,GAAE,EAAK;QACnCP,IAAG,GAAIf,MAAM,CAACuB,WAAW,EAAC;QAC1BP,cAAc,CAACD,IAAI;MACrB,CAAC;IACH;IAEAI,YAAY,EAAC;IAEb3B,KAAK,CACH,CAAC;MAAA,OAAMS,KAAK,CAACM,IAAI;IAAA,GAAE;MAAA,OAAMN,KAAK,CAACO,IAAI;IAAA,EAAC,EACpC,UAACgB,MAAM,EAAEC,MAAM,EAAK;MAClBV,IAAG,GAAIf,MAAM,CAACuB,WAAW,EAAC;MAC1B,IAAIC,MAAM,CAAC,CAAC,MAAM,MAAM,EAAE;QACxBT,IAAG,GAAIA,IAAI,CAACP,IAAI,CAAC,UAACkB,CAAC,EAAEC,CAAC,EAAK;UACzB,OAAOA,CAAC,CAACC,KAAI,GAAIF,CAAC,CAACE,KAAI;QACzB,CAAC;MACH;MACAZ,cAAc,CAACD,IAAI;IACrB,CAAC,EACD;MAAEc,IAAI,EAAE,IAAI;MAAEC,SAAS,EAAE;IAAK,EAChC;IAEA,IAAMC,SAAQ,GAAI,SAAZA,SAAQA,CAAIC,CAAA,EAAK;MACrB/B,KAAK,CAACS,IAAG,GAAIsB,CAAC,CAACzB,IAAG;MAClBN,KAAK,CAACY,WAAU,GAAImB,CAAC,CAACC,KAAI;IAC5B;IAEA,IAAMC,OAAM,GAAI,SAAVA,OAAMA,CAAA,EAAU;MACpBjC,KAAK,CAACS,IAAG,GAAI,KAAI;IACnB;IAEA,IAAMyB,QAAO,GAAI,SAAXA,QAAOA,CAAIH,CAAA,EAAK;MACpB,IAAIA,CAAC,CAACpB,IAAG,KAAM,MAAM,EAAE;QACrBjB,MAAM,CAACyC,OAAO,CAAC;UACbC,OAAO,EAAE;QACX,CAAC,EACEhB,IAAI,CAAC,YAAM;UACV;UACArB,MAAM,CAACsC,cAAc,CAACrC,KAAK,CAACY,WAAW;UACvC,IAAMN,IAAG,GAAIN,KAAK,CAACM,IAAG;UACtBN,KAAK,CAACM,IAAG,GAAI,GAAE;UACfN,KAAK,CAACM,IAAG,GAAIA,IAAG;UAChBN,KAAK,CAACS,IAAG,GAAI,KAAI;QACnB,CAAC,UACK,CAAC,YAAM;UACXT,KAAK,CAACS,IAAG,GAAI,KAAI;QACnB,CAAC;MACL;IACF;IAEA,IAAM6B,SAAQ,GAAI,SAAZA,SAAQA,CAAA,EAAU;MACtB;MACApB,YAAY,EAAC;MACblB,KAAK,CAACa,WAAU,GAAI,KAAI;MACxB0B,UAAU,CAAC,YAAM;QACf,IAAMjC,IAAG,GAAIN,KAAK,CAACM,IAAG;QACtBN,KAAK,CAACM,IAAG,GAAI,GAAE;QACfN,KAAK,CAACM,IAAG,GAAIA,IAAG;QAChBN,KAAK,CAACa,WAAU,GAAI,IAAG;QACvBlB,KAAK,CAAC,MAAM;QACZK,KAAK,CAACC,OAAM,GAAI,KAAI;MACtB,CAAC,EAAE,IAAI;IACT;IAEA,OAAAuC,aAAA,CAAAA,aAAA,KACKlD,MAAM,CAACU,KAAK,CAAC;MAChBiC,OAAO,EAAPA,OAAO;MACPC,QAAQ,EAARA,QAAQ;MACRJ,SAAS,EAATA,SAAS;MACTQ,SAAQ,EAARA;IAAQ;EAEZ,CAAC;EACDG,UAAU,EAAE;IACVjD,UAAU,EAAVA,UAAU;IACVI,WAAU,EAAVA;EACF;AACF"},"metadata":{},"sourceType":"module","externalDependencies":[]}